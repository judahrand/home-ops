---
kind: Cluster
name: main
kubernetes:
  version: v1.31.2
talos:
  version: v1.8.2
features:
  backupConfiguration:
    interval: 1h0m0s
patches:
  - file: ./patches/cluster/cluster-discovery.yaml
  - file: ./patches/cluster/containerd.yaml
  - file: ./patches/cluster/nfs.yaml
  - file: ./patches/cluster/sysctl.yaml
  - file: ./patches/cluster/openebs-local.yaml
  - file: ./patches/cluster/hostdns.yaml
  - file: ./patches/cluster/nameservers.yaml
  - file: ./patches/cluster/nodeip.yaml
  - file: ./patches/cluster/matter-server.yaml
---
kind: ControlPlane
machines:
  - 5e9756d4-a256-4c38-a4f5-6bf4d8f4d45c
  - 27784e80-6699-11ef-8573-998d87080b00
  - 6636e600-6652-11ef-8d81-e890dc700f00
patches:
  - file: ./patches/control-plane/cluster.yaml
---
kind: Machine
name: 5e9756d4-a256-4c38-a4f5-6bf4d8f4d45c
systemExtensions:
  - siderolabs/qemu-guest-agent
patches:
  - name: interfaces.yaml
    inline:
      machine:
        network:
          hostname: k8s-0
          interfaces:
            - interface: bond0
              bond:
                mode: active-backup
                interfaces:
                  - enxbc2411908a93
              dhcp: false
              vlans:
                - vlanId: 42
                  dhcp: true
                  mtu: 1500
                  dhcpOptions:
                    routeMetric: 1024
                  vip:
                    ip: 10.0.42.120
                - vlanId: 60
                  dhcp: true
                  mtu: 1500
                  dhcpOptions:
                    routeMetric: 4096
  - file: ./patches/cluster/volume-config.yaml
---
kind: Machine
name: 27784e80-6699-11ef-8573-998d87080b00
install:
  disk: /dev/nvme0n1
systemExtensions:
  - siderolabs/i915-ucode
patches:
  - name: hostname.yaml
    inline:
      machine:
        network:
          hostname: k8s-1
  - file: ./patches/un100p/interfaces.yaml
  - file: ./patches/cluster/volume-config.yaml
---
kind: Machine
name: 6636e600-6652-11ef-8d81-e890dc700f00
install:
  disk: /dev/nvme0n1
systemExtensions:
  - siderolabs/i915-ucode
patches:
  - name: hostname.yaml
    inline:
      machine:
        network:
          hostname: k8s-2
  - file: ./patches/un100p/interfaces.yaml
  - file: ./patches/cluster/volume-config.yaml
