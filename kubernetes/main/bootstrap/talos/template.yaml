---
kind: Cluster
name: main
kubernetes:
  version: v1.31.2
talos:
  version: v1.8.3
patches:
  - file: ./patches/cluster/cluster-discovery.yaml
  - file: ./patches/cluster/containerd.yaml
  - file: ./patches/cluster/nfs.yaml
  - file: ./patches/cluster/sysctl.yaml
  - file: ./patches/cluster/openebs-local.yaml
  - file: ./patches/cluster/hostdns.yaml
  - file: ./patches/cluster/nameservers.yaml
  - file: ./patches/cluster/nodeip.yaml
  - file: ./patches/cluster/matter-server.yaml
---
kind: ControlPlane
machines:
  - 3411fb80-b7c8-11ee-b2cc-90bf27fa6400
  - 27784e80-6699-11ef-8573-998d87080b00
  - 6636e600-6652-11ef-8d81-e890dc700f00
patches:
  - file: ./patches/control-plane/cluster.yaml
---
kind: Machine
name: 3411fb80-b7c8-11ee-b2cc-90bf27fa6400
install:
  disk: /dev/nvme0n1
systemExtensions:
  - siderolabs/amdgpu-firmware
  - siderolabs/uinput
patches:
  - name: hostname.yaml
    inline:
      machine:
        network:
          hostname: k8s-0
  - name: uinput.yaml
    inline:
      machine:
        kernel:
          modules:
            - name: uinput
  - file: ./patches/um780_xtx/interfaces.yaml
  - file: ./patches/um780_xtx/volume-config.yaml
---
kind: Machine
name: 27784e80-6699-11ef-8573-998d87080b00
install:
  disk: /dev/nvme0n1
systemExtensions:
  - siderolabs/i915-ucode
patches:
  - name: hostname.yaml
    inline:
      machine:
        network:
          hostname: k8s-1
  - file: ./patches/un100p/interfaces.yaml
  - file: ./patches/un100p/volume-config.yaml
---
kind: Machine
name: 6636e600-6652-11ef-8d81-e890dc700f00
install:
  disk: /dev/nvme0n1
systemExtensions:
  - siderolabs/i915-ucode
patches:
  - name: hostname.yaml
    inline:
      machine:
        network:
          hostname: k8s-2
  - file: ./patches/un100p/interfaces.yaml
  - file: ./patches/un100p/volume-config.yaml
